var SimpleKPI,$sr;(function(n){var t;(function(t){"use strict";var i=function(){function t(){this.reportId="dvReport"}return t.prototype.init=function(){var i=this;$(function(){var r,u,f;$s.animation=typeof evoPdfConverter=="undefined";$("div.column-left > h4").click(function(n){var t=$(n.currentTarget),i=t.attr("data-accord");return t.toggleClass("down-arrow"),t.toggleClass("up-arrow"),$("div.column-left > div[data-accord="+i+"]").slideToggle(),!1});$("a[data-export=excel]").click(t.getExcel);$("a[data-export=pdf]").click(t.getPdf);$("#aDeleteReport").click(function(t){var r=$(t.currentTarget).data("link").toString(),u=$s.labels.Are_you_sure_you_want_to_delete_this_report,i=$("#delete-confirmation");return i.length<=0&&(i=$('<div id="delete-confirmation" title="'+$s.labels.Please_Confirm+'" style="display: none"><\/div>').appendTo($("body"))),i.html("<p>"+u+"<\/p>"),i.dialog({modal:!0,resizable:!1,position:{of:window,my:"center bottom",at:"center center"},buttons:[{text:$s.labels.Yes_delete_it,click:function(t){$.ajax({url:r,type:"POST",cache:!1,data:[{name:"X-HTTP-Method-Override",value:"DELETE"}],beforeSend:function(){n.Helpers.Helper.setLoader()},success:function(){Helper.clearLoader();window.location.replace("/Reports")},complete:function(){n.Helpers.Helper.clearLoader()}});$(t.currentTarget).dialog("close")}},{text:$s.labels.No,click:function(n){$(n.currentTarget).dialog("close")}}]}),t.preventDefault(),!1});$("#aSaveReport").click(function(t){var u=$(t.currentTarget).data("link").toString(),r;return t.preventDefault(),i.options.name||(i.options.name=$("input#ReportName").val()),i.options.name.length<1?n.Helpers.Helper.dialog($s.labels.Please_enter_a_name_for_your_report):(r=[{name:"ReportId",value:i.selectedReportId},{name:"ReportName",value:i.options.name},{name:"ViewType",value:i.viewType},{name:"JsonOptions",value:$.toJSON(i.options)},{name:"ReportType",value:"U"}],$.ajax({url:u,type:"POST",cache:!1,data:r,beforeSend:function(){n.Helpers.Helper.setLoader()},success:function(n){Helper.clearLoader();$("body").append(n)},complete:function(){n.Helpers.Helper.clearLoader()}})),!1});$("#aSaveAsReport").click(function(i){var r=$(i.currentTarget).data("link").toString(),u=$("input#SelectedViewID").val();return u&&(r+="?selID="+u),$.ajax({url:r,type:"GET",cache:!1,data:{name:"X-Requested-With",value:"XMLHttpRequest"},success:function(i){n.Helpers.Popups.createPopup("#dvEditReport",!1);$("#dvEditReport").html(i);n.Helpers.Popups.repositionPopup("#dvEditReport");t.initSaveAs()}}),i.preventDefault(),!1});i.report=new n.KpiViews[i.viewType](i.options,i.reportId,$("#dvReport"));$("div.reports-settings > h3").click(function(){return $("div.reports-settings > div").slideToggle(),!1});$("div.reports-options > a").click(function(n){var t=$(n.currentTarget),i=$("#"+t.attr("data-form")),r=t.attr("data-head");return $("div.reports-settings > h3").html(r),$("div.reports-settings div.table").hide(),i.show(),$("div.reports-settings > div").slideDown(),n.preventDefault(),!1});$sr.sharedToGroups!=null&&(r=new n.Controls.MultiSelector($("#aShareGroups"),{labelSingular:$s.labels.Group,labelPlural:$s.labels.Groups,labelAll:$s.labels.All_Groups,allWhenEmpty:!1,data:$s.groups,itemIds:$sr.sharedToGroups,isGroup:!0,onDone:function(n){$sr.sharedToGroups=n}}));$sr.sharedToUsers!=null&&(u=new n.Controls.MultiSelector($("#aShareUsers"),{labelSingular:$s.labels.User,labelPlural:$s.labels.Users,labelAll:$s.labels.All_Users,allWhenEmpty:!1,data:$s.users,itemIds:$sr.sharedToUsers,onDone:function(n){$sr.sharedToUsers=n}}));$sr.restrictData!=null&&(f=new n.Controls.SingleSelector($("#aShareViewAll"),{items:[{id:"true",name:$s.labels.Yes},{id:"false",name:$s.labels.No}],id:$sr.restrictData.toString(),onSelect:function(n){$sr.restrictData=n==="true"}}));$("#aPublicShareGenerate").click(function(n){var t=$(n.currentTarget);return $.ajax({cache:!1,type:"POST",url:t.attr("href"),data:[{name:"X-Requested-With",value:"XMLHttpRequest"}],success:function(n){$("#PublicShareLink").val(n)}}),n.preventDefault(),!1});$("#btnShareSubmit").click(function(t){var r=$(t.currentTarget).attr("href"),u=[{name:"ReportId",value:i.selectedReportId},{name:"SharedToGroups",value:i.sharedToGroups},{name:"SharedToUsers",value:i.sharedToUsers},{name:"RestrictData",value:i.restrictData},{name:"PublicShareLink",value:$("#PublicShareLink").val()}];return $.ajax({url:r,type:"POST",cache:!1,data:u,beforeSend:function(){n.Helpers.Helper.setLoader()},success:function(){Helper.clearLoader();window.location.reload()},complete:function(){n.Helpers.Helper.clearLoader()}}),t.preventDefault(),!1});i.report.initSettings();i.report.initPager();i.initRefineBy();i.report.getReport()})},t.prototype.initRefineBy=function(){var n=this;$("input#ReportName").keyup(function(t){n.options.name=$(t.currentTarget).val();$("#h1Name").html(n.options.name)});$("input#ReportName").val(n.reportName);$("#h1Name").html(n.reportName);n.report.setReportDate()},t.prototype.sharedInit=function(){var t=this;$(function(){$s.animation=!0;t.report=new n.KpiViews[t.viewType](t.options,t.reportId,$("#dvReport"));t.report.initPager();t.report.loadReportView()})},t.prototype.printInit=function(){var t=this;$(function(){$s.animation=!1;t.report=new n.KpiViews[t.viewType](t.options,t.reportId,$("#dvReport"));t.report.setReportDate();t.report.getReport()})},t.getExcel=function(t){var i=$.extend({},$sr.options),u=n.Helpers.Helper.dateParse(i.from),f=n.Helpers.Helper.dateParse(i.to),r;return u!=null&&u.isValid()&&f!=null&&f.isValid()&&i.kpiIds!=null&&(r={},i.from=u.format("YYYY-MM-DD"),i.to=f.format("YYYY-MM-DD"),i.compareFrom!=null&&(i.compareFrom=Helper.dateParse(i.compareFrom).format("YYYY-MM-DD")),i.compareTo!=null&&(i.compareTo=Helper.dateParse(i.compareTo).format("YYYY-MM-DD")),r.viewType=$sr.viewType,r.options=$.toJSON(i),r.viewName=$("#h1Name").text(),n.Helpers.Helper.formSubmit("/Reports/ToExcel.xlsx","post",r)),t.preventDefault(),!1},t.getPdf=function(t){var i=jQuery.extend({},$sr.options),r;return i.perPage=9999999,r={viewType:$sr.viewType,options:$.toJSON(i),name:i.name,token:$s.shareToken},n.Helpers.Helper.formSubmit($(this).attr("href"),"post",r),t.preventDefault(),!1},t.initSaveAs=function(){$sr.options.name=$("#dvSettings input#ReportName").val();$("#frmSaveAs input#ViewType").val($sr.viewType);$("#frmSaveAs input#JsonOptions").val($.toJSON($sr.options));$("#frmSaveAs input#ReportName").val($sr.options.name).keyup(function(n){$sr.options.name=$(n.currentTarget).val();$("input#JsonOptions").val($.toJSON($sr.options))})},t.saveAsSuccess=function(){n.Helpers.Popups.closePopup("div.popup")},t}();t.Reports=i})(t=n.Views||(n.Views={}))})(SimpleKPI||(SimpleKPI={}));$sr=new SimpleKPI.Views.Reports