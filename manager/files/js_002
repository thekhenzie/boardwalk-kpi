var Helper,SimpleKPI,$s;(function(n){var t;(function(n){"use strict";var t=function(){function n(){var n=this;$("#formulaEditor").length&&(n.input=$("#formulaEditor")[0],n.input.contentEditable="true",n.input.innerHTML="",$(n.input).unbind(),$("a.kpi-formula-button").unbind("click").click(function(t){var i=$(this).attr("data-value");return n.setText(i),t.preventDefault(),!1}),$(n.input).keypress(function(n){var t=n.charCode?n.charCode:n.keyCode,i=new RegExp("[0-9aAvVgGmMiInNxXsSuU.\\+-/*() ]");if((n.keyCode===t||n.keyCode!==37)&&!($.inArray(n.keyCode,[8,16,32,37,39,46])>-1)&&!i.test(String.fromCharCode(t))){n.preventDefault();return}}),$(n.input).keyup(function(t){var i="which"in t?t.which:t.keyCode,r=rangy.getSelection();n.range=r.getRangeAt(0);n.range.endContainer.parentNode.nodeName==="B"&&(n.range.selectNode(n.range.endContainer.parentNode),r.setSingleRange(n.range),(i===8||i===46)&&n.range.deleteContents());this.input!=null&&this.change(this.input.innerHTML)}),$(n.input).click(function(t){var i=rangy.getSelection();return n.range=i.getRangeAt(0),n.range.endContainer.parentNode.nodeName==="B"&&(n.range.selectNode(n.range.endContainer.parentNode),i.setSingleRange(n.range)),t.preventDefault(),!1}))}return n.prototype.setText=function(n){var t=rangy.getSelection(),i=document.createTextNode(" "+n+" ");this.range&&this.range.isValid()||(this.range=rangy.createRangyRange(this.input));this.range.deleteContents();this.range.insertNode(i);this.range.setStartAfter(i);t.setSingleRange(this.range);t.collapseToEnd()},n.prototype.resetToEnd=function(){var n,t;try{n=this;n.range=rangy.createRange();n.range.selectNodeContents(n.input);t=rangy.getSelection();t.setSingleRange(n.range);t.collapseToEnd();n.range.collapse(!1)}catch(i){return}},n.prototype.update=function(){$("span.rangySelectionBoundary").remove();var n=$("<div />").html($(this.input).html()),t="";n!=null&&n.length>0&&(n.children("b[data-id]").each(function(n,t){$(t).replaceWith("["+$(t).attr("data-id")+"]")}),t=n.text());$("#"+$(this.input).attr("data-input-id")).val(t).trigger("change")},n.prototype.setKpi=function(n,t){var r,i,u,f;try{r=rangy.getSelection();i=document.createElement("b");i.setAttribute("data-id",n);i.appendChild(document.createTextNode("["+t+"]"));this.range&&this.range.isValid()||(this.range=rangy.createRangyRange(this.input));u=document.createTextNode(" ");f=document.createTextNode(" ");this.range.deleteContents();this.range.insertNode(u);this.range.setStartAfter(u);this.range.insertNode(i);this.range.setStartAfter(i);this.range.insertNode(f);this.range.setStartAfter(f);r.setSingleRange(this.range);r.collapseToEnd()}catch(e){return}},n}();n.FormulaEditor=t})(t=n.Helpers||(n.Helpers={}))})(SimpleKPI||(SimpleKPI={})),function(n){var t;(function(n){"use strict";var t=function(){function t(){}return t.setViewLabels=function(n,i){var u=$("#"+i).parent(),r,f;n!=null&&(n.name!=null&&n.name.length>0?$(u).find("div.name").html(n.name).css("height",""):$(u).find("div.name").html("").css("height","12px"),r=t.getViewDateLabel(n.from,n.to),f=t.getViewDateLabel(n.compareFrom,n.compareTo),f.length>1&&(r+="&nbsp;&nbsp;&nbsp;("+f+")"),$("#h2Date").html(r),$(u).find("div.options > b").html(r))},t.formatValueLabel=function(n,t,i){var u="",r;return i==null&&(i=!1),n!=null&&(r=Number(n),isNaN(r)||(i&&(r/=100),u=t!=null?r.numberFormat(t):r.toString())),u},t.getViewDateLabel=function(t,i){var r=n.Helper.dateParse(t),u=n.Helper.dateParse(i),f="";return t!=null&&r.isValid()&&i!=null&&u.isValid()&&(t=r.format("D MMM YYYY"),i=u.format("D MMM YYYY"),f=t!==i?t+" - "+i:t),f},t.getWeekNo=function(n,t){var r=n.week(),i;return $s.useIsoWeek&&(r=n.isoWeek()),t>1&&(i=moment().year(n.year()).month(t-1).date(1),n.month()<t-1&&(i=moment().year(n.year()-1).month(t-1).date(1)),i.isValid()&&(i.isoWeekday()!==$s.startDayOfWeek?i.startOf("isoWeek").isoWeekday($s.startDayOfWeek):i.isoWeekday($s.startDayOfWeek-7),i=i.subtract("days",1),r=Math.round(n.diff(i,"days")/7),$s.startDayOfWeek===7&&(r+=1),r===0&&(r=1))),r},t.getQuarter=function(n,t,i){var r=n.year(),u=n.month()+1+(13-t),f,e;return(u>12&&(u-=12),u>n.month()+1&&(r-=1),f=t>1?r.toString()+"-"+(r-1999).toString():r.toString(),e=Math.ceil(u/3),i)?$s.labels.Quarter+" "+e+"<br/>("+f+")":$s.labels.Quarter+" "+e+" ("+f+")"},t.getDateLabel=function(n,t,i,r){var f,u,e;r===void 0&&(r=!1);f="";u=moment();t!=null&&t.length>0&&(u=moment(t,"YYYY-MM-DD"),u=moment().year(u.year()).month(u.month()).date(u.date()));switch(n){case"Y":i>1?(i>u.month()+1&&u.subtract(1,"years"),f=u.format("YYYY")+"-"+u.add(1,"years").format("YY")):f=u.format("YYYY");break;case"Q":f=this.getQuarter(u,i,r);break;case"M":f=u.format("MMMM YYYY");break;case"W":while(u.isoWeekday()!==$s.startDayOfWeek)u.subtract(1,"days");e=this.getWeekNo(u,i);f=r?$s.labels.Week+" "+e.toString()+"<br/>("+u.format("DD MMM YYYY")+")":$s.labels.Week+" "+e.toString()+" ("+u.format("DD MMM YYYY")+")";break;case"D":f=u.format("YYYY-MM-DD")===moment().format("YYYY-MM-DD")?$s.labels.Today:u.format("YYYY-MM-DD")===moment().subtract(1,"days").format("YYYY-MM-DD")?$s.labels.Yesterday:u.format("DD MMM YYYY")}return f},t.getMinValue=function(n){var t=null,i,r;if(n!=null)for(i=0;i<n.length;i++)r=Number(n[i]),(t===null||r<t)&&(t=r);return t},t.getMinChartValue=function(n,t){var i=this.getMinValue(n);return t||(t=0),i&&(i-=i*(t/100)),i},t.getMaxChartValue=function(n,t){var i=this.getMaxValue(n);return t||(t=0),i&&(i+=i*(t/100)),i},t.getMaxValue=function(n){var t=null,i,r;if(n!=null)for(i=0;i<n.length;i++)r=Number(n[i]),(t===null||r>t)&&(t=r);return t},t.toNumberArray=function(n){var i=[],r,t;if(n!=null&&n.length>0)for(r=n.split(","),t=0;t<r.length;t++)i[t]=Number(r[t]),isNaN(i[t])&&(i[t]=0);return i},t.formatAxisDateLabels=function(t,i,r){if(i==="Date"||i==="DateGroup"){var u=n.Helper.dateParse(t);switch(r){case"D":return u.format("D MMM YY");case"W":return u.format("D MMM YY");case"M":return u.format("MMM YYYY");case"Q":return u.format("MMM YYYY");case"Y":return $s.financialMonth>1?u.format("YYYY")+"-"+u.add(1,"years").format("YY"):u.format("YYYY")}}return t},t.getTargetPercTitle=function(n){var t="";return n!=null&&($s.calcOfTarget?t=n===1?$s.labels.on_target:$s.labels.of_target:n===0?t=$s.labels.on_target:n>0?t=$s.labels.above_target:n<0&&(t=$s.labels.below_target)),t},t.getTargetColour=function(n,t){var r="#b70b0b",u="#90da25",i="";return n!=null&&t!=="N"&&($s.calcOfTarget?n>=1?i=u:n<1&&(i=r):n>0?i=u:n<0&&(i=r)),i},t.getTargetArrow=function(n,t){var i="";return n!=null&&t!=="N"&&($s.calcOfTarget?n>=1?i=t==="D"?"green-down-arrow":"green-up-arrow":n<1&&(i=t==="D"?"red-up-arrow":"red-down-arrow"):n>0?i=t==="D"?"green-down-arrow":"green-up-arrow":n<0&&(i=t==="D"?"red-up-arrow":"red-down-arrow"),i.length>0&&(i+=" sprite")),i},t.getTargetArrowLarge=function(n,t){var i="";return n!=null&&t!=="N"&&($s.calcOfTarget?n>=1?i=t==="D"?"white-down-arrow-large":"white-up-arrow-large":n<1&&(i=t==="D"?"white-up-arrow-large":"white-down-arrow-large"):n>0?i=t==="D"?"white-down-arrow-large":"white-up-arrow-large":n<0&&(i=t==="D"?"white-up-arrow-large":"white-down-arrow-large"),i.length>0&&(i+=" sprite")),i},t.getTargetPerc=function(n,t,i){function u(n,t,i){var r=null;return t!==0&&(t===n?r=1:t!==0&&(r=Math.round(n/t*100)/100),t<0&&i!=="D"?r=2-r:t>0&&i==="D"&&(r=(r-2)*-1)),r}var r=null;return n!=null&&t!=null&&($s.calcOfTarget?r=u(n,t,i):t!==0?(n-=t,t<0&&(t*=-1),r=Math.round(n/t*100)/100,i==="D"&&(r=r*-1)):r=0),r},t.getOfGoalPerc=function(n,t,i){var r=null;return t!==0&&(t===n?r=1:t!==0&&(r=Math.round(n/t*100)/100),t<0&&i!=="D"?r=2-r:t>0&&i==="D"&&(r=(r-2)*-1)),r},t.getGoalColour=function(n,t){var i="";return n!=null&&t!=="N"&&(n>=1?i="#90da25":n<1&&(i="#b70b0b")),i},t.getChangePerc=function(n,t){var i=0;return n!=null&&t!=null&&(t!==0?(n-=t,t<0&&(t*=-1),i=Math.round(n/t*100)/100):i=0),i},t.getChangeBackColour=function(n,t){var r="#b70b0b",u="#90da25",i="#D0D0D0";return n!=null&&t!=="N"&&(n>0?i=t==="D"?r:u:n<0&&(i=t==="D"?u:r)),i},t.getChangeArrow=function(n){var t="";return n!=null&&(n>0?t="white-up-arrow":n<0&&(t="white-down-arrow"),t.length>0&&(t+=" sprite")),t},t.getChangeArrowLarge=function(n){var t="";return n!=null&&(n>0?t="white-up-arrow-large":n<0&&(t="white-down-arrow-large"),t.length>0&&(t+=" sprite")),t},t.getColourMap=function(n,t,i,r,u){var o=[],c=r!=null?r:"#62AFEA",l=u!=null?u:"#b70b0b",f=[],s=[],e,h;if(n!=null&&(f=typeof n=="string"?this.toNumberArray(n):n.slice()),t!=null&&(s=typeof t=="string"?this.toNumberArray(t):t.slice()),f!=null)for(e=0;e<f.length;e++)s.length===f.length?(h=s[e]-f[e],i==="U"&&h>0||i==="D"&&h<0?o.push(l):o.push(c)):o.push(c);return o},t.getRagResult=function(n,t,i,r){var u=null;if(n!=null&&t!=null)try{var o=$.parseJSON(t),s=this.toNumber(o[0])*i,f=this.toNumber(o[1])*i,e=this.toNumber(o[2])*i,h=this.toNumber(o[3])*i;r!=="D"?(isNaN(s)||isNaN(f)?!isNaN(f)&&n<f&&(u="R"):n>=s&&n<f&&(u="R"),isNaN(f)||isNaN(e)||n>=f&&n<e&&(u="A"),isNaN(e)||isNaN(h)?!isNaN(e)&&n>=e&&(u="G"):n>=e&&n<=h&&(u="G")):(isNaN(s)||isNaN(f)?!isNaN(f)&&n>f&&(u="R"):n<=s&&n>f&&(u="R"),isNaN(f)||isNaN(e)||n<=f&&n>e&&(u="A"),isNaN(e)||isNaN(h)?!isNaN(e)&&n<=e&&(u="G"):n<=e&&n>=h&&(u="G"))}catch(c){return u}return u},t.getRagColour=function(t,i,r,u){var f=this.getRagResult(t,i,r,u);return f==="R"?n.Graph.red:f==="A"?n.Graph.amber:f==="G"?n.Graph.green:null},t.toNumber=function(n){var t=NaN;return n!=null&&(typeof n=="string"&&n.length>0?t=Number(n):typeof n=="number"&&(t=n)),t},t.red="#FF0000",t.amber="#FFAE00",t.green="#94DA2C",t}();n.Graph=t})(t=n.Helpers||(n.Helpers={}))}(SimpleKPI||(SimpleKPI={})),function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.ajaxFormSubmit=function(t,i){function f(n){return n==="GET"||n==="POST"}var u=$(t).serializeArray()||[],r=t.method||"GET";r=r.toUpperCase();f(r)||(r="POST",u.push({name:"X-HTTP-Method-Override",value:r}));u.push({name:"X-Requested-With",value:"XMLHttpRequest"});$.ajax({type:"POST",cache:!1,url:t.action,data:u,beforeSend:function(){n.setLoader()},complete:function(){n.clearLoader()},success:function(t,r,u){n.clearLoader();i(t,r,u)}})},n.imageUploader=function(t,i){function e(){r.onComplete=function(t,i,r){r.success?u():n.dialog(r.error)};f=new qq.FileUploader(r)}function u(){var t,i,r,u,f,e;n.clearLoader();t=(new Date).getTime();$("[data-is-logo=true]").length&&(i=$("[data-is-logo=true]").css("background-image").replace(/\"\)/,""),i+="?"+t+'")',$("[data-is-logo=true]").css("background-image",i));$("i.large-profile").length&&(r=$("i.large-profile").attr("data-item-id"),u=$("i.large-profile").attr("data-size"),$("i.large-profile").css("background-image","url(/Shared/_ProfileImage/"+r+"?size="+u+"&ts="+t+")"));$("i.small-profile").length&&(f=$("i.small-profile").attr("data-item-id"),e=$("i.small-profile").attr("data-size"),$("i.small-profile").css("background-image","url(/Shared/_ProfileImage/"+f+"?size="+e+"&ts="+t+")"))}var r={element:document.getElementById("picture_file"),action:t,debug:!1,multiple:!1,maxConnections:1,allowedExtensions:["jpg","png","gif"],params:{id:i},sizeLimit:2048576,template:'<div class="qq-uploader"><div class="button-blue qq-upload-button">'+$s.labels.Upload_new_image+'<\/div><ul class="qq-upload-list"><\/ul><div class="qq-upload-drop-area"><\/div><\/div>',messages:{typeError:$s.labels.FileUploader_typeError,sizeError:$s.labels.FileUploader_sizeError,minSizeError:$s.labels.FileUploader_minSizeError,emptyError:$s.labels.FileUploader_emptyError},onSubmit:function(){n.setLoader()},onComplete:function(n,t,i){i.success?u():e()},showMessage:function(t){n.dialog(t)}},f=new qq.FileUploader(r)},n.setLoader=function(){function n(n,t,i,r,u){var f=b.path(n);return f.attr("fill",t),f.attr("stroke-width",i),f.attr("stroke",r),f.attr("opacity",u),f}function p(){if($("div.loader").length<=0){a();return}r.animate({path:"M30,11 L30,11 L30,30 L30,30"},t,i);e.stop();e.remove();e=n("M30,30 L30,30 L30,49 L30,49",o,"1",o,l);e.animate({path:"M30,30 L46,21 L46,39 L30,49"},t,i,k);console.log("Loader animate A")}function k(){if($("div.loader").length<=0){a();return}u.animate({path:"M14,21 L14,21 L14,39 L14,39"},t,i);r.stop();r.remove();r=n("M46,21 L46,21 L46,39 L46,39",s,"0",s);r.toBack();y.toBack();r.animate({path:"M30,11 L46,21 L46,39 L30,30"},t,i,d)}function d(){if($("div.loader").length<=0){a();return}f.animate({path:"M30,30 L30,30 L30,49 L30,49"},t,i);u.stop();u.remove();u=n("M30,11 L30,11 L30,30 L30,30",h,"0",h);u.toBack();y.toBack();u.animate({path:"M30,11 L14,21 L14,39 L30,30"},t,i,g)}function g(){if($("div.loader").length<=0){a();return}e.animate({path:"M46,21 L46,21 L46,39 L46,39"},t,i);f.stop();f.remove();f=n("M14,21 L14,21 L14,39 L14,39",c,"1",c,l);f.animate({path:"M14,21 L30,30 L30,49 L14,39 "},t,i,p)}function a(){e.stop();e.remove();r.stop();r.remove();u.stop();u.remove();f.stop();f.remove()}var w=$('<div class="loader"><\/div>').appendTo("body"),v=$('<div id="dvLoader"><\/div>').appendTo(w);v.show().position({my:"center top",at:"center top+400",of:window});var b=Raphael(v[0],70,70),o="#5ab1e4",s="#918e8b",h="#57585c",c="#90da25",l="0.8",t=260,i="",y=n("M30,0 L56,15 L56,45 L30,60 L4,45 L4,15 L30,0","#fff","0","#fff"),r=n("M30,11 L46,21 L46,39 L30,30",s,"0",s),u=n("M30,11 L14,21 L14,39 L30,30",h,"0",h),f=n("M30,30 L14,21 L14,39 L30,49",c,"0",c,l),e=n("M30,30 L30,30 L30,49 L30,49",o,"1",o,l);p()},n.clearLoader=function(){$("div.loader").remove()},n.dialog=function(n,t){if(n){$("div#dialog-message").remove();var i=$('<div id="dialog-message">').appendTo($("body"));i.html("<p>"+n+"<\/p>");i.dialog({modal:!0,resizable:!1,width:400,buttons:{OK:function(){t&&t();i.dialog("close");i.remove()}},position:{of:window,my:"center bottom",at:"center center"}})}},n.ajaxFail=function(t,i,r){if(r===void 0&&(r=!0),t.status===401)n.dialog($s.labels.Your_session_has_expired,function(){location.reload()});else if(t.status===550){var u=t.responseText?t.responseText:i;r&&n.dialog(u)}else n.sendError(t)},n.sendError=function(t){t&&n.sendErrorDetail(t.status,t.statusText,t.responseText)},n.sendCatchError=function(t){if(t!=null&&t.name!=null){var i={type:t.name,message:t.message,file:t.fileName,line:t.lineNumber,col:t.columnNumber,stack:t.stack};n.sendErrorDetail(-1,i,window.location.href,"")}},n.sendErrorDetail=function(n,t,i,r){var u,f,e;try{n!=null&&n!==200&&n!==0&&n!==550&&t!=null&&(u="",f="",$.toJSON&&(e={response:r,status:n,href:i,error:t},u=$.toJSON(e)),u!==$s.lastError&&($.ajax({url:"/Error/_JScriptError",type:"POST",cache:!1,global:!1,data:{name:"X-Requested-With",value:"XMLHttpRequest",Error:u+f},error:function(){return}}),$s.lastError=u))}catch(o){return}},n.formSubmit=function(n,t,i){var r=$("<form />",{action:n,method:t,style:"display: none;"});i!=null&&$.each(i,function(n,t){$("<input />",{type:"hidden",name:n,value:t}).appendTo(r)});r.appendTo("body").submit()},n.getIeVersion=function(){var n=-1,t,i;return navigator.appName==="Microsoft Internet Explorer"&&(t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})"),i.exec(t)!==null&&(n=parseFloat(RegExp.$1))),n},n.dateParseWeekDate=function(n){var t=moment(n,"YYYY-MM-DD");return $s.startDayOfWeek===1?t.day()===0?t.add(-6,"days"):t.add(1-t.day(),"days"):t.add(-t.day(),"days")},n.dateParseWeek=function(n){var t;return t=$s.startDayOfWeek===1?moment().day()===0?moment().add(-6,"days"):moment().add(1-moment().day(),"days"):moment().add(-moment().day(),"days"),t.add(n,"days")},n.dateParseMonth=function(n,t){var i=moment().date(1);return i=i.add(n,"months"),i.add(t,"days")},n.dateParseQuarter=function(n,t){var r=Math.ceil((moment().month()+1)/3)-1,i=moment().month(r*3).date(1);return i=i.add(n,"months"),i.add(t,"days")},n.dateParseYear=function(n,t){var i=moment().month(0).date(1);return i=i.add(n,"years"),i.add(t,"days")},n.dateParseFinancialQuarter=function(n,t){var f=$s.financialMonth-1,i=moment(),r=i.month()+1+(12-f),u;return r>12&&(r-=12),u=Math.ceil(r/3)-1,i=this.dateParseFinancialYear(0,0).add(u*3,"months"),i=i.add(n,"months"),i.add(t,"days")},n.dateParseFinancialYear=function(n,t){var r=$s.financialMonth-1,i=moment(),u=i.month();return i=u<r?moment().subtract(1,"years").month(r).date(1):moment().month(r).date(1),i=i.add(n,"years"),i.add(t,"days")},n.dateParse=function(n){var t,u,i;switch(n){case"start this week":t=this.dateParseWeek(0);break;case"end this week":t=this.dateParseWeek(6);break;case"start last week":t=this.dateParseWeek(-7);break;case"end last week":t=this.dateParseWeek(-1);break;case"start this month":t=this.dateParseMonth(0,0);break;case"end this month":t=this.dateParseMonth(1,-1);break;case"start last month":t=this.dateParseMonth(-1,0);break;case"end last month":t=this.dateParseMonth(0,-1);break;case"start this quarter":t=this.dateParseQuarter(0,0);break;case"end this quarter":t=this.dateParseQuarter(3,-1);break;case"start last quarter":t=this.dateParseQuarter(-3,0);break;case"end last quarter":t=this.dateParseQuarter(0,-1);break;case"start this year":t=this.dateParseYear(0,0);break;case"end this year":t=this.dateParseYear(1,-1);break;case"start last year":t=this.dateParseYear(-1,0);break;case"end last year":t=this.dateParseYear(0,-1);break;case"start this financial quarter":t=this.dateParseFinancialQuarter(0,0);break;case"end this financial quarter":t=this.dateParseFinancialQuarter(3,-1);break;case"start last financial quarter":t=this.dateParseFinancialQuarter(-3,0);break;case"end last financial quarter":t=this.dateParseFinancialQuarter(0,-1);break;case"start this financial year":t=this.dateParseFinancialYear(0,0);break;case"end this financial year":t=this.dateParseFinancialYear(1,-1);break;case"start last financial year":t=this.dateParseFinancialYear(-1,0);break;case"end last financial year":t=this.dateParseFinancialYear(0,-1);break;default:if(/today|end/ig.test(n)){t=moment();var f=/end/ig.test(n)?-1:0,e=n.replace(/today|end|\s|\d|-/ig,""),r=Number(n.replace(/\s|[a-zA-Z]/ig,""));/days|day|d/ig.test(e)?t.add(r+f,"days"):/weeks|week/ig.test(e)?(r=r*7+f,t=this.dateParseWeek(r)):/months|month/ig.test(e)?t=this.dateParseMonth(r,f):/financialquarter/ig.test(e)?(r=r*3,t=this.dateParseFinancialQuarter(r,f)):/financialyear/ig.test(e)?t=this.dateParseFinancialYear(r,f):/quarters|quarter/ig.test(e)?(r=r*3,t=this.dateParseQuarter(r,f)):/years|year/ig.test(e)&&(t=this.dateParseYear(r,f))}else/todate/ig.test(n)?(t=moment(),u=n.replace(/todate|\s|\d|-/ig,""),i=Number(n.replace(/\s|[a-zA-Z]/ig,"")),/days|day|d/ig.test(u)?t.add(i,"days"):/weeks|week/ig.test(u)?(i=i*7,t.add(i,"days")):/months|month/ig.test(u)?t.add(i,"months"):/financialquarter/ig.test(u)?(i=i*3,t.add(i,"months")):/financialyear/ig.test(u)?t.add(i,"years"):/quarters|quarter/ig.test(u)?(i=i*3,t.add(i,"months")):/years|year/ig.test(u)&&t.add(i,"years")):t=moment(n,"YYYY-MM-DD")}return t},n.dropDownMenu=function(n,t,i,r){i===void 0&&(i="right bottom");r===void 0&&(r="right top");var f=!1,e=!0,o=$(n),u=$(t);$(n+","+t).hover(function(n){return f=!0,o.addClass("selected"),e&&u.stop().show(),u.position({my:r,at:i,of:o}),e&&u.hide(),u.fadeIn(400,function(){u.position({my:r,at:i,of:o})}),e=!1,f=!0,n.preventDefault(),!1},function(n){return f=!1,setTimeout(function(){f||(o.removeClass("selected"),u.stop().hide(),e=!0)},300),n.preventDefault(),!1})},n.fixValue=function(n){var i="",r,t;if(n==null||n.replace==null)return i;for(n=n.replace(/[^\d.-]/g,""),n.indexOf("-")>-1&&(n=n.replace(/[^\d.]/g,""),n="-"+n),r=0,t=n.length-1;t>=0;t--)n.charAt(t)==="."?(r++,r<=1&&(i+=n.charAt(t))):i+=n.charAt(t);return i.split("").reverse().join("")},n.fixValueNumber=function(n){var r,t="",i;if(n==null||n.replace==null)return null;for(n=n.replace(/[^\d.-]/g,""),n.indexOf("-")>-1&&(n=n.replace(/[^\d.]/g,""),n="-"+n),r=0,i=n.length-1;i>=0;i--)n.charAt(i)==="."?(r++,r<=1&&(t+=n.charAt(i))):t+=n.charAt(i);return(t=t.split("").reverse().join(""),t.length>0)?Number(t):null},n.kpiIconLink=function(n){return n.indexOf("/Shared")<=-1?"/Shared/_KPIIcon/"+n:n},n.encodeHtml=function(n){return n!=null?$("<div />").html(n).text():""},n.decodeHtml=function(n){return n!=null?$("<div />").text(n).html():""},n.textAreaReSize=function(n){$(n).css({height:"auto","overflow-y":"hidden"}).height(n.scrollHeight)},n.entryBitwiseCheck=function(n,t){var i=!1,r=moment(n,"YYYY-MM-DD").isoWeekday();return(t==null||isNaN(t))&&(t=254),(Math.pow(2,r)&t)!=0&&(i=!0),i},n}();n.Helper=t})(t=n.Helpers||(n.Helpers={}))}(SimpleKPI||(SimpleKPI={})),function(n){var t;(function(n){"use strict";var t=function(){function t(){}return t.createPopup=function(n,t){var r,i,u;if(t===void 0&&(t=!0),r=this,i=$(n),n!=null){u=$("div.popup-overlay");u.length||$('<div class="popup-overlay"><\/div>').appendTo($("body"));i.length||(i=$('<div id="'+n.replace("#","")+'" class="popup ui-draggable popup-form"><\/div>').appendTo($("body")));t&&r.zIndex++;i.css("z-index",r.zIndex.toString());i.on("click","#btnClosePopup, a.cancel",function(n){return i.hide(),$("div.popup:visible").length||$("div.popup-overlay").remove(),n.preventDefault(),!1})}},t.closePopup=function(n){var t=$(n);t.hide();$("div.popup:visible").length||$("div.popup-overlay").remove();tinymce!=null&&tinymce.remove()},t.repositionPopup=function(n){var t=$(n);t.length&&(t.show(),t.position({my:"center",at:"center top+35%",of:window,collision:"fit"}),t.draggable({handle:$(n).find(" > h2")}),t.hide().fadeIn())},t.contactSupport=function(){$(function(){$.validator.unobtrusive.parse("#dvContactSupportPopup")})},t.contactSupportSuccess=function(){t.closePopup("#dvContactSupportPopup");n.Helper.dialog($s.labels.A_ticket_has_been_sent)},t.confirmationDialog=function(n,t,i,r,u){var e,f,o;r===void 0&&(r=!1);u===void 0&&(u=null);e=$s.labels.Yes_do_it;f=$("#confirmation-dialog");f.length||(f=$('<div id="confirmation-dialog" style="display: none"><\/div>').appendTo($("body")));f.html("<p>"+t+"<\/p>");o=[];u!=null&&(o=u);r&&(o.push({name:"X-HTTP-Method-Override",value:"DELETE"}),e==null&&(e=$s.labels.Yes_delete_it));f.dialog({modal:!0,resizable:!1,position:{of:window,my:"center bottom",at:"center center"},buttons:[{text:e,click:function(){$.ajax({url:n,type:"POST",cache:!1,data:o,success:i});f.dialog("close")}},{text:$s.labels.No,click:function(){f.dialog("close")}}]})},t.zIndex=1001,t}();n.Popups=t})(t=n.Helpers||(n.Helpers={}))}(SimpleKPI||(SimpleKPI={})),function(n){var t;(function(t){"use strict";var i=function(){function t(t){var i=this,r;this.modelJson=t;this.columnSize=function(n){var r=i,t="100%";if(n===1)switch(r.dash.Layout()){case 55:t="50%";break;case 33:t="34%";break;case 73:t="70%";break;case 37:t="30%"}else if(n===2)switch(r.dash.Layout()){case 55:t="50%";break;case 33:t="33%";break;case 73:t="30%";break;case 37:t="70%"}else switch(r.dash.Layout()){case 33:t="33%"}return t};this.tabClick=function(n,t){var r=i;return $(t.currentTarget).parent().addClass("selected"),$("div.kpi-view-item").attr("data-loaded","true"),r.loadDash(n.DashId),window.history.pushState(null,null,"/Dashboards?id="+n.DashId),t.preventDefault(),!1};this.addDashClick=function(t,r){var u=i;return n.Helpers.Popups.createPopup("#dvAddDashPopup",!1),n.Helpers.Popups.repositionPopup("#dvAddDashPopup"),ko.viewmodel.updateFromModel(u.addDash,u.modelJson.AddDash),$("input#DashboardName").focus(),r.preventDefault(),!1};this.addChartClick=function(n,t){var r=i;return r.toggleCharts(),t.preventDefault(),!1};this.addDashSubmit=function(t){function u(t){t=$.parseJSON(t);r.tabs(t.Tabs);n.Helpers.Popups.closePopup("#dvAddDashPopup");r.loadDash(t.DashId,!0)}var r=i;$(t).valid()&&Helper.ajaxFormSubmit(t,u)};this.addDashLayoutClick=function(n,t){var r=i,u=$(t.currentTarget);r.addDash.Layout(Number(u.data("value")))};this.addDashBackColourClick=function(n,t){var r=i,u=$(t.currentTarget);r.addDash.BackgroundColour(u.data("value").toString())};this.addDashChartThemeClick=function(n,t){var r=i,u=$(t.currentTarget);r.addDash.ChartTheme(u.data("value").toString())};this.deleteDashClick=function(t,r){function o(n){n=$.parseJSON(n);u.controlCancel();u.tabs(n.Tabs);ko.viewmodel.updateFromModel(u.dash,n.Dash);u.tabs().length>0&&u.loadDash(u.tabs()[0].DashId)}var u=i,f=u.dash.DashId(),e=$s.labels.Are_you_sure_you_want_to_delete_the_whole_dashboard;return n.Helpers.Popups.confirmationDialog("/Dashboards/_Delete/"+f.toString(),e,o,!0),r.preventDefault(),!1};this.copyDashClick=function(t,r){function o(n){n=$.parseJSON(n);u.tabs(n.Tabs)}var u=i,f=u.dash.DashId(),e=$s.labels.Are_you_sure_you_want_to_copy_this_dashboard;return n.Helpers.Popups.confirmationDialog("/Dashboards/_Copy?id="+f.toString(),e,o,!0),r.preventDefault(),!1};this.fullScreenDashClick=function(n,t){var r=i,u;for($("div.tab-menu, div.header-status-bar, div.section-head, div.dash-controls-holder > p").hide(),$("#ulFSControls, div.dash-controls-holder > h3").show(),r.hideCharts(),r.controlCancel(),u=0;u<r.tabs().length;u++)if(r.tabs()[u].DashId===r.dash.DashId()){r.fsDashIndex=u;break}return r.isFullScreen(!0),t.preventDefault(),!1};this.chartOver=function(n,t){$("div.kpi-view-desc").stop().hide();$("div.kpi-view-desc[data-link="+n.ViewName+"]").show().position({of:$(t.currentTarget),my:"left top",at:"left bottom"}).hide().fadeIn(300)};this.chartOut=function(){$("div.kpi-view-desc").stop().hide()};this.viewDescClick=function(n,t){var r=i;return n.ShowDesc(!n.ShowDesc()),r.dash.IsShare()||r.saveShowDesc(n.UserDashboardViewID(),n.ShowDesc()),t.preventDefault(),!1};this.viewDescCloseClick=function(n,t){var r=i;return n.ShowDesc(!1),r.dash.IsShare()||r.saveShowDesc(n.UserDashboardViewID(),!1),t.preventDefault(),!1};this.deleteViewClick=function(t,i){function f(n){$("div.kpi-view-item[data-view-id="+n+"]").remove()}var r=t.UserDashboardViewID(),u=$s.labels.Are_you_sure_you_want_to_delete_this_view;return n.Helpers.Popups.confirmationDialog("/Dashboards/_DeleteKPIView/"+r.toString(),u,f,!0),i.preventDefault(),!1};this.addViewClick=function(n,t){var r=i;return r.toggleCharts(),r.editView.loadView(null,r.dash.DashId(),n.ViewId),t.preventDefault(),!1};this.editViewClick=function(n,t){var r=i;return r.editView.loadView(n.UserDashboardViewID(),r.dash.DashId(),null),t.preventDefault(),!1};this.copyViewClick=function(t,r){var u=i;return u.copyToViewId(t.UserDashboardViewID),n.Helpers.Popups.createPopup("#dvCopyViewPopup",!1),n.Helpers.Popups.repositionPopup("#dvCopyViewPopup"),r.preventDefault(),!1};this.copyViewSubmit=function(t){function u(){n.Helpers.Popups.closePopup("#dvCopyViewPopup");r.loadDash(r.dash.DashId(),!0)}var r=i;$(t).valid()&&Helper.ajaxFormSubmit(t,u)};this.reduceFSClick=function(n,t){var r=i;return $("div.tab-menu, div.header-status-bar, div.section-head, div.dash-controls-holder > p").show(),$("#ulFSControls, div.dash-controls-holder > h3").hide(),r.clearFSPlay(),r.isFullScreen(!1),t.preventDefault(),!1};this.prevFSClick=function(n,t){var r=i,f=r.fsDashIndex-1,u;return r.fsDashIndex=f<0?r.tabs().length-1:f,u=r.tabs()[r.fsDashIndex].DashId,$("div.kpi-view-item").attr("data-loaded","true"),r.loadDash(u),window.history.pushState(null,null,"/Dashboards?id="+u),t.preventDefault(),!1};this.nextFSClick=function(n,t){var r=i;return r.nextFSDash(),t.preventDefault(),!1};this.playFSClick=function(n,t){var r=i;return $(t.currentTarget).children("svg").css("fill","#90da25"),r.fsPlayId=setInterval(function(){r.nextFSDash()},r.refreshRate()),t.preventDefault(),!1};this.stopFSClick=function(n,t){var r=i;return r.clearFSPlay(),t.preventDefault(),!1};this.refreshFSClick=function(n,t){var r=i,u=Number($(t.currentTarget).data("refresh"));return u!==r.refreshRate()&&(r.refreshRate(u),r.fsPlayId!=null&&(clearInterval(r.fsPlayId),r.fsPlayId=null,r.fsPlayId=setInterval(function(){r.nextFSDash()},r.refreshRate()))),t.preventDefault(),!1};this.initDashboard=function(){var t=i;if(t.initDash&&(t.initDash=!1,t.controlCancel(),t.dash.DashId()==null||t.dash.HasViews()||$s.wizardStep!=null?t.hideCharts():t.showCharts(),t.dash.DashId()!=null)){$s.shareToken=t.dash.ShareToken();n.Helpers.Helper.dropDownMenu("#liSettings","#dvSettingsDropdown");t.dash.BackColour()&&($("body").css("background-color",t.dash.BackColour()),t.dash.BackColour==="#808080"&&$("div.dash-content-area > h1").css("color","#FFFFFF"));t.dash.IsShare()||$("div.sortable").sortable({connectWith:"div.sortable",handle:"b.move",placeholder:"placeholder",opacity:.6,cursorAt:{left:150,top:20},delay:200,forceHelperSize:!0,revert:!0,tolerance:"pointer",cursor:"move",start:function(n,t){t.helper.css("width","30%")},update:function(n,i){var u=i.item.find("div.view, div.view-hidden"),r=u.attr("id");$sd.views[r]&&$sd.views[r].reload(!1);t.saveViewPositions()}});$("div.kpi-view-item > div.description > textarea").keyup(function(){$(this).attr("data-changed","true")});$("div.kpi-view-item > div.description > textarea").blur(function(){var n=$(this),t;n.attr("data-changed")==="true"&&(t={dashboardViewId:$(n).attr("data-view-id"),viewDesc:Helper.encodeHtml($(n).val())},n.attr("data-changed","false"),$.ajax({cache:!1,traditional:!0,dataType:"json",type:"POST",url:"/Dashboards/_SaveViewDesc",context:document.body,data:t}))});$("div.kpi-view-item > div.description > textarea").each(function(){Helper.textAreaReSize(this)}).on("input",function(){Helper.textAreaReSize(this)});$("div.kpi-view-item a.settings").each(function(t,i){var r=$(i).attr("data-view-id");n.Helpers.Helper.dropDownMenu("div.kpi-view-item a.settings[data-view-id="+r+"]","div.kpi-view-item ul.settings[data-view-id="+r+"]","right bottom")});t.loadNextDash()}return""};r=this;r.modelJson.Dash!=null&&($sd.chartTheme=r.modelJson.Dash.ChartTheme);r.initDash=!0;r.tabs=ko.observableArray(r.modelJson.Tabs);r.charts=ko.observableArray(r.modelJson.Charts);r.reports=ko.observableArray(r.modelJson.Reports);r.addDash=ko.viewmodel.fromModel(r.modelJson.AddDash);r.dash=ko.viewmodel.fromModel(r.modelJson.Dash);r.copyToViewId=ko.observable("");r.isFullScreen=ko.observable(!1);r.refreshRate=ko.observable(12e4);r.editView=new n.Views.DashboardKpiView;$s.animation=typeof evoPdfConverter=="undefined";$("#ulTabs").sortable({handle:"a",placeholder:"placeholder",forceHelperSize:!0,revert:!0,tolerance:"pointer",helper:"clone",update:function(){r.saveTabOrder()}});$("#ulTabs > li.add").disableSelection();n.Helpers.Helper.dropDownMenu("#liExport","#dvExportDropdown");n.Helpers.Helper.dropDownMenu("#liRefreshRate","#dvRefreshRateDropdown");$("div.dash-create-message").length&&(n.Helpers.Popups.createPopup("div.dash-create-message",!1),n.Helpers.Popups.repositionPopup("div.dash-create-message"),$("#aStartFresh").click(function(t){return $s.setWizardStep(null),$("div.dashboard-view-hint").fadeIn(),n.Helpers.Popups.closePopup("div.dash-create-message"),r.showCharts(),t.preventDefault(),!1}),$("#aExampleDash").click(function(t){return $s.setWizardStep(null),$.ajax({url:"/Dashboards/_AddExampleDash",type:"POST",cache:!1,data:[{name:"X-Requested-With",value:"XMLHttpRequest"}],success:function(){n.Helpers.Popups.closePopup("div.dash-create-message");r.reloadDash();$s.wizardStep=null}}),t.preventDefault(),!1}))}return t.prototype.nextFSDash=function(){var n=this,i=n.fsDashIndex+1,t;n.fsDashIndex=i>=n.tabs().length?0:i;t=n.tabs()[n.fsDashIndex].DashId;$("div.kpi-view-item").attr("data-loaded","true");n.loadDash(t);window.history.pushState(null,null,"/Dashboards?id="+t)},t.prototype.clearFSPlay=function(){var n=this;$("#ulFSControls svg").css("fill","");clearInterval(n.fsPlayId);n.fsPlayId=null},t.prototype.reloadDash=function(){var n=this;n.loadTabs();n.loadDash(n.dash.DashId(),!0)},t.prototype.loadNextDash=function(){if($("div.kpi-view-item[data-loaded=false]").length){var t=$("div.kpi-view-item[data-loaded=false]:first"),i="dvView"+t.attr("data-view-id"),r=t.attr("data-view-type");n.KpiViews!=null&&n.KpiViews[r]!=null&&($sd.views[i]=new n.KpiViews[r]($sd.options,i,t),$sd.views[i].loadView(this))}else typeof evoPdfConverter!="undefined"&&window.setTimeout(evoPdfConverter.startConversion,500)},t.prototype.saveTabOrder=function(){var n={},t="";$("#ulTabs > li").each(function(n,i){var r=$(i).data("item-id");r&&(t+=r+",")});n.DashboardIds=t;$.ajax({cache:!1,traditional:!0,dataType:"json",type:"POST",url:"/Dashboards/_SaveTabOrder",context:document.body,data:n})},t.prototype.saveShowDesc=function(n,t){var i={dashboardViewId:n,showDesc:t};$.ajax({cache:!1,traditional:!0,dataType:"json",type:"POST",url:"/Dashboards/_SaveShowDesc",context:document.body,data:i})},t.prototype.saveViewPositions=function(){var n={},t=[];$("div.column").each(function(n,i){var u=$(i).attr("data-col"),r=1;$(i).find("div.kpi-view-item").each(function(n,i){t.push({ViewId:$(i).attr("data-view-id"),Column:u,Row:r});r++})});n.Positions=$.toJSON(t);$.ajax({cache:!1,traditional:!0,dataType:"json",type:"POST",url:"/Dashboards/_SaveViewPositions",context:document.body,data:n})},t.prototype.toggleCharts=function(n){n===void 0&&(n=!1);var t=this,i=$("#dvCharts");$("div.dashboard-view-hint").hide();i.is(":visible")||n?t.hideCharts():t.showCharts()},t.prototype.hideCharts=function(){$("div.kpi-view-list").hide();$("#dvCharts").slideUp();$("#liAddView").removeClass("selected")},t.prototype.showCharts=function(){var t=this;t.controlCancel();$("#dvCharts").slideDown(400);$("#ulControls li").removeClass("selected");$("#liAddView").addClass("selected");n.Helpers.Helper.dropDownMenu("#aChartReports","#dvChartReportsList")},t.prototype.controlCancel=function(){$("#dvSettings").data("selectedItem","").slideUp();$("#ulControls li").removeClass("selected")},t.prototype.loadTabs=function(){var n=this;$.ajax({cache:!1,traditional:!0,type:"GET",url:"/Dashboards/_Tabs",beforeSend:function(){Helper.setLoader()},complete:function(){Helper.clearLoader()},success:function(t){Helper.clearLoader();t=$.parseJSON(t);n.tabs(t.Tabs)}})},t.prototype.loadDash=function(n,t){var i,r;t===void 0&&(t=!1);i=this;(i.dash==null||n!==i.dash.DashId()||t)&&(r={},r.id=n,$.ajax({cache:!1,traditional:!0,type:"GET",url:"/Dashboards/_Dashboard",data:r,beforeSend:function(){Helper.setLoader()},complete:function(){Helper.clearLoader()},success:function(n){var t=$.parseJSON(n);Helper.clearLoader();i.initDash=!0;t!=null&&($sd.chartTheme=t.ChartTheme);ko.viewmodel.updateFromModel(i.dash,t);i.controlCancel();i.initDashboard()}}))},t}();t.DashboardsModel=i})(t=n.Models||(n.Models={}))}(SimpleKPI||(SimpleKPI={})),function(n){var t;(function(t){"use strict";var r=function(){function t(n,t){var r=this;this.redirect=n;this.addDash=t;this.selectGroup=function(n){var t=[];$.each(r.modelJson.connectors,function(i,r){n.groupId===r.groupId&&t.push(r)});r.selGroupId(n.groupId);r.groupConnectors(t)};this.selectPopular=function(){r.selGroupId(-1);r.groupConnectors(r.modelJson.popular)};var i=this,u=$.deparam.querystring(),f="/DataSources/_DataConnectors";u.dsId!=null&&(f+="/"+u.dsId);$.ajax({url:f,type:"GET",cache:!1,data:{name:"X-Requested-With",value:"XMLHttpRequest"},success:function(n){var t,r;i.modelJson=n;i.groups=ko.observableArray(i.modelJson.groups);i.groupConnectors=ko.observableArray(i.modelJson.popular);i.selGroupId=ko.observable(-1);t=$.deparam.querystring();t.grpId!=null?(r=Number(t.grpId),r!==-1&&i.selectGroup({groupId:Number(t.grpId)})):t.dsId!=null&&i.setDataSource(Number(t.dsId));ko.applyBindings(i,$("#dvSelectDC")[0])}})}return t.prototype.setDataSource=function(t){var r=this,u="/DataSources/_DataConnector/"+t.toString();$.ajax({url:u,type:"GET",cache:!1,data:{name:"X-Requested-With",value:"XMLHttpRequest"},beforeSend:function(){n.Helpers.Helper.setLoader()},success:function(n){Helper.clearLoader();r.dataSourceModel=new i(r.redirect,r.addDash,n);$("#dvSelectDC").hide();$("#dvSetDC").fadeIn()},complete:function(){n.Helpers.Helper.clearLoader()}})},t}(),i;t.DataConnectorsModel=r;i=function(){function t(t,i,r){var f=this,u;this.redirect=t;this.addDash=i;this.getDataClick=function(){var i=f,t={};t.DataSourceId=i.dataSource.dsId();t.ProfileId=i.profileId;t.Name=$("#aAccounts").text();t.Month=i.month;t.Year=i.year;t.Kpis=i.kpiIds;t.AddDash=i.addDash;$.ajax({cache:!1,traditional:!0,type:"POST",url:"/DataSources/_DataConnector",context:document.body,data:t,beforeSend:function(){n.Helpers.Helper.setLoader()},success:function(){Helper.clearLoader();window.location.replace(i.redirect)},complete:function(){n.Helpers.Helper.clearLoader()}})};this.cancelClick=function(){$("#dvSetDC").hide();$("#dvSelectDC").fadeIn()};u=this;u.modelJson=r;u.dataSource=ko.viewmodel.fromModel(r);ko.applyBindings(u,$("#dvSetDC")[0]);r.accs&&r.accs.length>0&&(u.profileId=r.accs[0].id);u.month=r.selMonth;u.year=r.selYear;u.kpiIds=r.kpiIds;var e=new n.Controls.SingleSelector($("#aAccounts"),{items:r.accs,id:u.profileId,onSelect:function(n){u.profileId=n}}),o=new n.Controls.SingleSelector($("#aMonth"),{items:r.months,id:r.selMonth,onSelect:function(n){u.month=n}}),s=new n.Controls.SingleSelector($("#aYear"),{items:r.years,id:r.selYear,onSelect:function(n){u.year=n}}),h=new n.Controls.KpiMultiSelector($("#aMetrics"),{categories:r.cats,kpis:r.kpis,kpiIds:u.kpiIds,onClose:function(n){u.kpiIds!==n&&(u.kpiIds=n)}})}return t}();t.DataConnectorModel=i})(t=n.Models||(n.Models={}))}(SimpleKPI||(SimpleKPI={})),function(n){var t;(function(t){"use strict";var i=function(){function t(t){var r=this,i;this.modelJson=t;this.metricsSelector=$("#aDSMetrics");this.monthSelector=$("#aDSMonth");this.yearSelector=$("#aDSYear");this.statusName=function(n){var t;switch(n.status()){case"A":t=$s.labels.Ready;break;case"D":t=$s.labels.Disabled;break;case"R":t=$s.labels.Running;break;case"F":t=$s.labels.Failed;break;case"L":t=$s.labels.Not_linked;break;default:t=$s.labels.Unknown}return t};this.updatedOn=function(n){var t="",i=moment.utc(n.runEnd(),"YYYY-MM-DDTHH:mm:ss");return i.isValid()&&(t=moment(i.toDate()).format("DD MMM YYYY, HH:mm")),t};this.editClick=function(t){var i=r;n.Helpers.Popups.createPopup("#dvEditDS");n.Helpers.Popups.repositionPopup("#dvEditDS");i.editDataSource=t;i.ssMonth.setValue(i.editDataSource.month().toString());i.ssYear.setValue(i.editDataSource.year().toString());$.ajax({cache:!1,type:"POST",url:"/DataSources/_DataConnectorMetricsList/"+t.dcId().toString(),context:document.body,beforeSend:function(){n.Helpers.Helper.setLoader()},success:function(t){Helper.clearLoader();var r=new n.Controls.KpiMultiSelector(i.metricsSelector,{kpiIds:i.editDataSource.kpis(),categories:t.cats,kpis:t.kpis,onClose:function(n,t){i.editDataSource.kpis()!==n&&(i.editDataSource.kpis(n),i.editDataSource.noOfKpis(t))}})},complete:function(){n.Helpers.Helper.clearLoader()}})};this.saveClick=function(){var i=r,t={};t.DataSourceId=i.editDataSource.dataSourceId();t.Kpis=i.editDataSource.kpis();t.Month=i.editDataSource.month();t.Year=i.editDataSource.year();$.ajax({cache:!1,traditional:!0,type:"POST",url:"/DataSources/_SaveDataSource",context:document.body,data:t,beforeSend:function(){n.Helpers.Helper.setLoader()},success:function(){Helper.clearLoader();n.Helpers.Popups.closePopup("#dvEditDS")},complete:function(){n.Helpers.Helper.clearLoader()}})};this.cancelClick=function(){n.Helpers.Popups.closePopup("#dvEditDS")};this.getData=function(t){$.ajax({cache:!1,traditional:!0,type:"POST",url:"/DataSources/_GetData/"+t.dataSourceId(),context:document.body,beforeSend:function(){t.status("R")},success:function(i){i=$.parseJSON(i);i.Status!=null&&t.status(i.Status);i.Message!=null&&i.Message.length>0&&n.Helpers.Helper.dialog(i.Message);i.RunEnd!=null&&t.runEnd(i.RunEnd)},error:function(){t.status("F")}})};this.reLink=function(t){$.ajax({cache:!1,traditional:!0,type:"POST",url:"/DataSources/_GetData/"+t.dataSourceId(),context:document.body,beforeSend:function(){n.Helpers.Helper.setLoader();t.status("R")},success:function(){Helper.clearLoader();t.status("A")},complete:function(){n.Helpers.Helper.clearLoader()},error:function(){t.status("F")}})};this.disableDataSource=function(t){function r(n){t.status(n)}var i=t.status()!=="D"?$s.labels.Are_you_sure_you_want_to_disable_this_data_source:$s.labels.Are_you_sure_you_want_to_enable_this_data_source;n.Helpers.Popups.confirmationDialog("/DataSources/_DisableDataSource/"+t.dataSourceId(),i,r,!1)};this.deleteDataSource=function(t){function f(){i.dataSources.remove(t)}var i=r,u=$s.labels.Are_you_sure_you_want_to_delete_this_data_source;n.Helpers.Popups.confirmationDialog("/DataSources/_DeleteDataSource/"+t.dataSourceId(),u,f,!0)};i=this;i.dataSources=ko.viewmodel.fromModel(i.modelJson.dataSources);i.editDataSource=i.dataSources()[0];i.ssMonth=new n.Controls.SingleSelector(i.monthSelector,{items:i.modelJson.months,id:"1",onSelect:function(n){i.editDataSource.month(n)}});i.ssYear=new n.Controls.SingleSelector(i.yearSelector,{items:i.modelJson.years,id:i.modelJson.selYear.toString(),onSelect:function(n){i.editDataSource.year(n)}})}return t}();t.DataSourcesModel=i})(t=n.Models||(n.Models={}))}(SimpleKPI||(SimpleKPI={})),function(n){var t;(function(t){"use strict";var i=function(){function t(t){var r=this,i,u;this.modelJson=t;this.tabIndex=1;this.periodName=function(n){var t="";return n!=null&&(t=n.PeriodName+"<span>"+n.NoOfKPIs+"<\/span>"),t};this.dateLabel=function(t){var i=r,u=i.entryPeriodId();return n.Helpers.Graph.getDateLabel(u,t,$s.financialMonth,!0)};this.dateCssClass=function(n){var o=r,i,t="day",u,f,e;switch(o.entryPeriodId()){case"W":t="week";break;case"M":t="month";break;case"Q":t="quarter";break;case"Y":t="year"}return o.view()==="M"?t==="week"?(u=Helper.dateParseWeekDate(moment().format("YYYY-MM-DD")),f=Helper.dateParseWeekDate(n),i=u.isSame(f,"day")?"today":u.isBefore(f,"day")?"future":"past"):(e=moment(n,"YYYY-MM-DD"),i=moment().isSame(e,t)?"today":moment().isBefore(e,t)?"future":"past"):i="today",i};this.importClick=function(t,i){return n.Helpers.Popups.createPopup("#dvUpload",!1),n.Helpers.Popups.repositionPopup("#dvUpload"),i.preventDefault(),!1};this.periodClick=function(n,t){var i=r;return i.entryPeriodId(n.PK_KPIEntryPeriodID),$("tbKPIEntries").empty(),i.filterBy="-1",i.categories=null,i.entries=null,i.setDate(0),t.preventDefault(),!1};this.pastClick=function(n,t){var i=r;return i.setDate(-1),t.preventDefault(),!1};this.futureClick=function(n,t){var i=r;return i.setDate(1),t.preventDefault(),!1};this.calendarClick=function(n,t){return $("#EntryDate").pickmeup("show"),$("div.pickmeup").position({my:"left top",at:"left top",of:$(t.target),collision:"fit"}),t.preventDefault(),!1};this.viewClick=function(n,t){var i=r,u=$(t.currentTarget).data("view");return u!==i.view()&&(Helper.setLoader(),i.view(u),i.toggleView(),i.updateSparklines()),Helper.clearLoader(),t.preventDefault(),!1};this.saveClick=function(n,t){return $(t.currentTarget).find("span").fadeOut(1e3,function(){$(this).fadeIn(600)}),t.preventDefault(),!1};this.inputKeyUp=function(n){var f=r,t=$(n.currentTarget),e=Number(t.parents("tr[data-kpi-id]").data("kpi-id")),o=Number(t.parent().data("index")),s=t.data("type").toString(),u=Helper.fixValue(t.val()),i;return t.val(u),Helper.fixValueNumber(u)!==f.entries[e][s+"s"][o]?(i=t.data("ajax"),i!=null&&i.abort!=null&&i.abort(),t.addClass("changed"),t.data("changed",!0)):(t.removeClass("changed"),t.data("changed",!1)),!0};this.inputBlur=function(n){var s=r,h=!1,t=$(n.currentTarget),o=Number(t.parents("tr[data-kpi-id]").data("kpi-id")),e=Number(t.parent().data("index")),u=t.data("type").toString(),f,i;return t.length!=null&&t.data("changed")&&(f=Helper.fixValue(t.val()),i={},t.val(f),i.userId=s.userId(),i.entryDate=s.entryDates()[e],i.kpiId=o,i.actual=null,i.target=null,i.setActual=!1,i.setTarget=!1,i.setNotes=!1,i[u.toLowerCase()]=f,i["set"+u]=!0,u==="Actual"&&(h=$s.wizardStep===1),t.data("ajax",$.ajax({cache:!1,traditional:!0,type:"POST",url:"/KPIEntry/_SaveKPIEntry",data:i,beforeSend:function(){return!0},complete:function(){t.data("ajax",null)},success:function(n){if(n&&n.remove===!0)t.parent().parent().remove();else{if(t.removeClass("changed"),t.data("changed",!1),r.entries[o][u+"s"][e]=Helper.fixValueNumber(f),e===5){if(u==="Target"){var i=t.parents("tr[data-kpi-id]").find("td[data-index="+e+"] input.target");i.length&&i.val(f)}r.targetPercent(o)}t.parents("tr[data-kpi-id]").find("span.sparkline-holder").attr("data-update","");r.updateSparklines();h&&($("div.dashboard-hint").slideDown(),$("ul.tab-menu > li:first-child").css("background-color","#94da2c"),$s.setWizardStep(3))}},error:function(){return!0}}))),!0};this.notesClick=function(t){var f=r,i=$(t.currentTarget),e=Number(i.parents("tr[data-kpi-id]").data("kpi-id")),h=$('<div class="popup-overlay"><\/div>').appendTo($("body")),u=$('<div class="popup notes-popup"><\/div>').appendTo($("body")),c=$('<h2><img src="/Shared/_Icon/NoteColour" style="margin: 8px 15px 0 -20px;" /><span>'+$s.labels.Notes+'<\/span><a id="btnCloseNotesPopup" href="#"><svg viewBox="0 0 17 17"><path d="M1,0v16h16V0H1z M12.8,11.7c-0.4,0.4-0.9,0.4-1.3,0L9.1,9.3l-2.4,2.4c-0.4,0.4-0.9,0.4-1.3,0c-0.4-0.4-0.4-0.9,0-1.3L7.8,8L5.5,5.6c-0.4-0.4-0.4-0.9,0-1.3s0.9-0.4,1.3,0l2.4,2.4l2.4-2.4c0.4-0.4,0.9-0.4,1.3,0s0.4,0.9,0,1.3L10.4,8l2.4,2.4C13.2,10.7,13.2,11.3,12.8,11.7z"/><\/svg><\/a><\/h2>').appendTo(u),s,o;return u.draggable({handle:c}),$('<h3 style="line-height: 20px; padding: 8px 24px 0 24px;"><span style="color: #6FC0FF">'+n.Helpers.Graph.getDateLabel(f.entryPeriodId(),f.entryDate(),$s.financialMonth,!0)+"<\/span><br/>"+f.entries[e].Name+"<\/h5>").appendTo(u),s=$("<div><\/div>").appendTo(u),o=$('<textarea id="EditNotes" maxlength="500" cols="20" rows="5" style="margin-top: 20px" ><\/textarea>').appendTo(s),s.append('<h4><a id="btnNotesSave" href="#" class="button-green">'+$s.labels.Save+"<\/a><\/h4>"),u.position({my:"center bottom",at:"center center-100",of:window,collision:"fit"}),$("#btnNotesSave").click(function(n){var t=Helper.encodeHtml($.trim(o.val()));return r.entries[e].Notes!==t&&(t.length>0?(i.removeClass("no-notes-icon"),i.addClass("has-notes-icon"),i.attr("title",t)):(i.removeClass("has-notes-icon"),i.addClass("no-notes-icon"),i.removeAttr("title")),r.saveNotes(i,e,t)),h.remove(),u.remove(),n.preventDefault(),!1}),$("#btnCloseNotesPopup").click(function(n){return h.remove(),u.remove(),n.preventDefault(),!1}),o.val(f.entries[e].Notes),o.focus(),t.preventDefault(),!1};this.loadChart=function(){var i=$("span.sparkline-holder[data-update]"),e,t,u,r,f;i.length!=null&&(i=$(i[0]),e=Number(i.parents("tr[data-kpi-id]").data("kpi-id")),t=$ske.viewModel.entries[e],i.removeAttr("data-update"),t!=null&&(u=t.ShowTarget?t.Actuals.concat(t.Targets):t.Actuals,u.length>0&&(r=Math.min.apply(Math,u),f=Math.max.apply(Math,u),r>0&&(r=0),t.Actuals.length>0&&i.sparkline(t.Actuals,{barWidth:"6",barColor:"#90CF35",negBarColor:"#90CF35",type:"bar",width:"80px",height:"30px",lineColor:"#007dfb",fillColor:"#abdcf8",spotColor:"#007dfb",minSpotColor:"#007dfb",maxSpotColor:"#007dfb",normalRangeColor:"#e5e5e5",chartRangeMin:r,chartRangeMax:f,colorMap:n.Helpers.Graph.getColourMap(t.Actuals.join(),t.Targets.join(),t.Dir)}),t.Targets.length>0&&i.sparkline(t.Targets,{type:"line",lineColor:"#90cf35",fillColor:!1,spotColor:"#90cf35",minSpotColor:"#90cf35",maxSpotColor:"#90cf35",chartRangeMin:r,chartRangeMax:f,composite:!0,lineWidth:2})),setTimeout($ske.viewModel.loadChart,6)))};i=this;i.userId=ko.observable(i.modelJson.UserId);i.userFullName=ko.observable(i.modelJson.UserFullName);i.entryPeriodId=ko.observable(i.modelJson.EntryPeriodId);i.entryDate=ko.observable(i.modelJson.EntryDate);i.kpiEntryPeriods=ko.observableArray(i.modelJson.Periods);i.entryDates=ko.observableArray([]);i.filterBy="-1";i.view=ko.observable(i.modelJson.View);(i.entryDate()==null||i.entryDate().length<=0)&&i.entryDate(moment().format("YYYY-MM-DD"));u=new n.Controls.KpiSelector($("a#aChangeUser"),{kpis:i.modelJson.Users,kpiId:i.userId(),noneFoundLabel:$s.labels.No_users_found,kpiRequired:!1,isUsers:!0,replaceHtml:!1,onSelect:function(n){if(n!==i.userId()){var t=$("input#EntryDate").val(),r="/KPIEntry/Index/"+n+"?entryPeriodId="+i.entryPeriodId();t!=null&&(r+="&entryDate="+t);window.location.replace(r)}}});i.initImportForm();$("#EntryDate").pickmeup({date:new Date(i.entryDate()),format:"Y-m-d",hide_on_select:!0,change:function(n){if(n!=null){var t=moment(n,"YYYY-MM-DD");i.entryDate(t.format("YYYY-MM-DD"));i.setDate(0)}}});$("tbody").on("click","a.notes",i.notesClick);$("tbody").on("keyup","input[type=text]",i.inputKeyUp);$("tbody").on("blur","input[type=text]",i.inputBlur);i.setDate(0)}return t.prototype.targetPercent=function(t){var i=this,r=$("tr[data-kpi-id="+t+"] td.performance");if(r.length){var e=$("<div><\/div>"),o=$("<i><\/i>").appendTo(e),u=i.entries[t].Dir,s=i.entries[t].Actuals[5],h=i.entries[t].Targets[5],f=n.Helpers.Graph.getTargetPerc(s,h,u);return f!=null&&(u!=="N"&&o.addClass(n.Helpers.Graph.getTargetArrow(f,u)),o.html(f.numberFormat("0%"))),r.empty(),r.append(e)}return null},t.prototype.saveNotes=function(n,t,i){var u=this,r={},f=n.data("ajax");f!=null&&f.abort!=null&&f.abort();r.userId=u.userId();r.entryDate=u.entryDate;r.kpiId=t;r.actual=null;r.target=null;r.setActual=!1;r.setTarget=!1;r.setNotes=!0;r.notes=i;n.data("ajax",$.ajax({cache:!1,traditional:!0,type:"POST",url:"/KPIEntry/_SaveKPIEntry",data:r,beforeSend:function(){return!0},complete:function(){n.data("ajax",null)},success:function(){u.entries[t].Notes=i},error:function(){return!0}}))},t.prototype.initImportForm=function(){var t=this,i;if($("#frmUpload").ajaxForm({beforeSubmit:function(){return Helper.setLoader(),!0},error:function(n){var t=n.responseText?n.responseText:n.toString();Helper.clearLoader();Helper.dialog(t)},success:function(){Helper.clearLoader();t.hideUpload();t.clearImportForm();t.getEntries(t.entryDate(),t.entryDates());Helper.dialog($s.labels.Your_file_has_been_successfully_uploaded)}}),i=n.Helpers.Helper.getIeVersion(),i!==8&&i!==9)$("#dvUpload").on("click","#aSelectFile",function(n){return $("#uFile").show().focus().click().hide(),n.preventDefault(),!1});$(document).on("change","#uFile",function(n){var t=n.target.value.substring(n.target.value.lastIndexOf("\\")+1),i=new RegExp("^.*\\.(xls|XLS|xlsx|XLSX|csv|CSV)$");return t==null&&(t=""),t.match(i)||(t="",Helper.dialog($s.labels.Please_select_an_Excel_file_with_a_valid_extension)),t.length>0?($("#spnFileName").text(t),$("#frmUpload input[type=submit]").removeAttr("disabled").removeClass("button-disabled").addClass("button-green")):($("#spnFileName").text("No file selected"),$("#frmUpload input[type=submit]").attr("disabled","disabled").removeClass("button-green").addClass("button-disabled")),n.preventDefault(),!1})},t.prototype.hideUpload=function(){n.Helpers.Popups.closePopup("div.popup")},t.prototype.clearImportForm=function(){$("#uFile").val("");$("#spnFileName").text("No file selected");$("#frmUpload input[type=submit]").attr("disabled","disabled").removeClass("button-green").addClass("button-disabled")},t.prototype.getEntries=function(t,i){var r=this,u={};u.id=r.userId();u.entryDates=i.join();u.entryPeriodId=r.entryPeriodId();$.ajax({cache:!1,traditional:!0,type:"GET",url:"/KPIEntry/_KPIEntries",data:u,beforeSend:function(){Helper.setLoader()},complete:function(){Helper.clearLoader()},success:function(u){Helper.clearLoader();var f=$.parseJSON(u);r.tabIndex=1;r.entryDate(t);r.entryDates(i);r.entries=f.Entries;$("#tbKPIEntries").html(f.Html);r.categories==null&&(r.categories=f.Cats,r.ssFilterBy!=null&&r.ssFilterBy.destroy&&r.ssFilterBy.destroy(),r.ssFilterBy=new n.Controls.SingleSelector($("a#aFilterBy"),{label:$s.labels.Sort_By,items:r.categories,id:"-1",onSelect:function(n){r.filterBy!==n&&(r.filterBy=n,r.toggleCats())}}));r.addSort();r.toggleView();r.toggleCats();r.setClasses();r.updateSparklines();typeof evoPdfConverter!="undefined"&&window.setTimeout(evoPdfConverter.startConversion,1e3)}})},t.prototype.getDate=function(n,t){var u=this,r=u.entryPeriodId(),i=moment(n,"YYYY-MM-DD");return i=r==="W"?i.add(t*7,"days"):r==="M"?i.add(t,"months"):r==="Q"?i.add(t*3,"months"):r==="Y"?i.add(t,"years"):i.add(t,"days"),i.format("YYYY-MM-DD")},t.prototype.setDate=function(n){for(var t=this,r=[],u=t.getDate(t.entryDate(),n),i=-5;i<=1;i++)r.push(t.getDate(u,i));t.getEntries(u,r)},t.prototype.setDateLabel=function(){var t=this,i=t.entryPeriodId(),r=t.entryDate(),u=n.Helpers.Graph.getDateLabel(i,r,$s.financialMonth,!0);$("b.date-label").html(u)},t.prototype.addSort=function(){var n=this;$("table.kpi-entry > tbody > tr").length&&$("table.kpi-entry > tbody").sortable({items:"> tr[data-kpi-id]",handle:"img.kpi-icon",forceHelperSize:!0,revert:!0,update:function(){var t={},i=[],r=1;$(this).find("tr[data-kpi-id]").each(function(n,t){i.push({KpiId:$(t).data("kpi-id"),SortOrder:r});r++});t.userId=n.userId();t.order=$.toJSON(i);$.ajax({cache:!1,traditional:!0,dataType:"json",type:"post",url:"/KPIEntry/_SaveKPIsOrder",context:document.body,data:t})}})},t.prototype.updateSparklines=function(){var n=this;n.view()==="S"&&setTimeout(n.loadChart,5)},t.prototype.toggleView=function(){var n=this;n.view()==="S"?($("table.kpi-entry [data-view=S]").show(),$("table.kpi-entry [data-view=M]").hide(),$("td.actual[data-index=5]").removeClass("future").removeClass("past").addClass("today")):($("table.kpi-entry [data-view=M]").show(),$("table.kpi-entry [data-view=S]").hide(),n.setClasses())},t.prototype.toggleCats=function(){var n=this;n.filterBy==="-1"?$("tr[data-cat-id]").show():($("tr[data-cat-id]").hide(),$("tr[data-cat-id="+n.filterBy+"]").show())},t.prototype.setClasses=function(){for(var i,t=this,n=0;n<t.entryDates().length;n++)i=t.dateCssClass(t.entryDates()[n]),$("td.actual[data-index="+n.toString()+"]").removeClass("today").removeClass("future").removeClass("past").addClass(i)},t}();t.KpiEntryModel=i})(t=n.Models||(n.Models={}))}(SimpleKPI||(SimpleKPI={})),function(n){var t;(function(t){"use strict";var i=function(){function t(t){var i=this,r;this.modelJson=t;this.newKpi=!1;this.kpiName=function(n){var t=n.KpiName;return n.KpiDescription!=null&&n.KpiDescription.length>0&&(t+="<span>"+n.KpiDescription+"<\/span>"),t};this.users=function(n){var t="<b>"+n.Users+"<\/b>&nbsp;";return t+(n.Users===1?$s.labels.User:$s.labels.Users)};this.advOptionsLabel=function(){var n=i;return n.showAdvanced()?$s.labels.Hide_advanced_options:$s.labels.Show_advanced_options};this.daySelected=function(n,t){return(Number(t)&n)>0||t==null};this.ragValue=function(n,t){if(t!=null&&t.length>1){var i=$.parseJSON(t);if(i!=null&&typeof i=="object"&&i.length>=4)return i[n].toString()}return""};this.catClick=function(n){var t=i;n==null?n=t.selectedCategory==null?t.categories()[0]:t.selectedCategory:t.selectedCategory=n;n!=null&&(t.selectedCatId(n.CategoryId),t.modelJson.EditKpi.KpiCategoryId=n.CategoryId,t.modelJson.EditKpi.KpiCategoryName=n.CategoryName,t.editKpi.KpiCategoryId(n.CategoryId),t.editKpi.KpiCategoryName(n.CategoryName),t.closeFormView(),t.populateKpis(n.CategoryId.toString()))};this.addCatClick=function(){var t=i;n.Helpers.Popups.createPopup("#dvCategoryPopup",!1);n.Helpers.Popups.repositionPopup("#dvCategoryPopup");ko.viewmodel.updateFromModel(t.editCategory,t.modelJson.EditCategory);$("input#CategoryName").focus()};this.editCatClick=function(t){var r=i;n.Helpers.Popups.createPopup("#dvCategoryPopup",!1);n.Helpers.Popups.repositionPopup("#dvCategoryPopup");ko.viewmodel.updateFromModel(r.editCategory,t);$("input#CategoryName").focus()};this.saveCatSubmit=function(t){function u(t){r.categories($.parseJSON(t));n.Helpers.Popups.closePopup("#dvCategoryPopup")}var r=i;$(t).valid()&&Helper.ajaxFormSubmit(t,u)};this.deleteCatClick=function(t){function e(n){var t=$.parseJSON(n);r.categories($.parseJSON(n));f&&r.catClick(t[0])}var r=i,u=$s.labels.Are_you_sure_you_want_to_delete_this_category,f=r.editKpi.KpiCategoryId()===t.CategoryId;r.kpis().length&&(u=$s.labels.Are_you_sure_you_want_to_delete_this_category_with_kpis);n.Helpers.Popups.confirmationDialog("/Kpi/_DeleteCategory/"+t.CategoryId,u,e,!0)};this.showCatClick=function(){var n=$("div.column-left");n.width()<=50&&n.animate({width:"250px"},500,function(){n.removeClass("column-left-closed").addClass("media-ignore")})};this.editKpiClick=function(n,t){var r=i,u=$("#dvForm");$("div.no-kpis").hide();r.showAdvanced(!1);n.KpiId!=null?(r.newKpi=!1,ko.viewmodel.updateFromModel(r.editKpi,n)):(r.newKpi=!0,ko.viewmodel.updateFromModel(r.editKpi,r.modelJson.EditKpi));r.formInit();$("div.kpi-actions > a.link").removeClass("selected");n.KpiId==null&&$(t.target).addClass("selected");u.is(":hidden")?u.slideDown(400,function(){r.showAdvanced(n.IsCalculated);u.hide().show()}):r.showAdvanced(n.IsCalculated)};this.saveKpiSubmit=function(n){function r(n){t.categories($.parseJSON(n));t.closeFormView();t.populateKpis(t.selectedCatId().toString());t.formulaKpisList(null)}var t=i;$(n).valid()&&($s.editor!=null&&$s.editor.update!=null&&$s.editor.update(),Helper.ajaxFormSubmit(n,r))};this.closeFormView=function(){$("#dvForm").slideUp();$("div.kpi-actions > a.link").removeClass("selected")};this.showAdvOptions=function(){var n=i;n.showAdvanced(!n.showAdvanced())};this.showTemplatesClick=function(){n.Helpers.Popups.createPopup("#dvTemplatesPopup",!1);n.Helpers.Popups.repositionPopup("#dvTemplatesPopup");i.templatesInit()};this.headerSort=function(n,t){var e=i,u=$(t.target),f=u.attr("data-sort"),r=u.data("direction");r==null||r==="A"?(r="A",u.data("direction","D")):u.data("direction","A");e.kpis.sort(function(n,t){return n[f]<t[f]?r==="A"?-1:1:n[f]>t[f]?r==="A"?1:-1:0})};this.actionsCheckToggle=function(n,t){var i=$(t.target).prop("checked");return $("td.actions input[type=checkbox]").prop("checked",i),!0};this.actionEnable=function(){function e(){$("th.actions input, td.actions input:checked").prop("checked",!1);t.populateKpis(t.selectedCatId().toString());t.formulaKpisList(null)}var t=i,f=$s.labels.Are_you_sure_you_want_to_enable_this_KPI,r=t.checkedKpiIds(),u;return r.length>1&&(u=[{name:"id",value:r}],n.Helpers.Popups.confirmationDialog("/KPI/_EnableKPIs",f,e,!1,u)),!1};this.actionDisable=function(){function e(){$("th.actions input, td.actions input:checked").prop("checked",!1);t.populateKpis(t.selectedCatId().toString());t.formulaKpisList(null)}var t=i,f=$s.labels.Are_you_sure_you_want_to_disable_this_KPI,r=t.checkedKpiIds(),u;return r.length>1&&(u=[{name:"id",value:r}],n.Helpers.Popups.confirmationDialog("/KPI/_DisableKPIs",f,e,!1,u)),!1};this.actionDelete=function(){function e(n){t.categories($.parseJSON(n));t.populateKpis(t.selectedCatId().toString());t.formulaKpisList(null);t.closeFormView()}var t=i,f=$s.labels.Are_you_sure_you_want_to_delete_this_KPI,r=t.checkedKpiIds(),u;r.length>1&&(u=[{name:"id",value:r}],n.Helpers.Popups.confirmationDialog("/KPI/_DeleteKPIs",f,e,!0,u))};this.daysClick=function(n,t){var i=0;return $(t.currentTarget).toggleClass("selected"),$("ul#ulDailyDays > li.selected").each(function(n,t){var r=Number($(t).data("day"));i+=r}),n.DailyDaysBitwise(i),t.preventDefault(),!1};this.ragBlur=function(n){for(var r,u,i=[],t=0;t<4;t++)r=$("#RagValues"+t.toString()),u=Helper.fixValue(r.val()),r.val(u),i[t]=u;i.length>1?n.RagValues($.toJSON(i)):n.RagValues("")};r=this;r.selectedCatId=ko.observable(r.modelJson.SelectedCatId);r.categories=ko.observableArray(r.modelJson.Categories);r.kpis=ko.observableArray(r.modelJson.Kpis);r.editCategory=ko.viewmodel.fromModel(r.modelJson.EditCategory);r.editKpi=ko.viewmodel.fromModel(r.modelJson.EditKpi);r.showAdvanced=ko.observable(!1);r.formulaKpisList=ko.observable(null)}return t.prototype.templatesInit=function(){function u(){var n=i*r+r,f=i*r+1,u=t.modelJson.Templates.length;n>u&&(n=u);$("#dvTemplates > a, #dvTemplates > div.clearboth").remove();$.each(t.modelJson.Templates,function(t,i){if(t>=f-1&&t<n){var r=$('<a href="#"><\/a>');r.data("item-id",i.TemplateId);r.append("<b>"+i.KpisCount+"<\/b>");r.append("<h6>"+i.TemplateName+"<\/h6>");r.append("<p>"+i.TemplateDesc+"<\/p>");r.append("<span>Add this template<\/span>");r.appendTo("#dvTemplates")}});$("#dvTemplates").append('<div class="clearboth"><\/div>');$("#spnPages").html(f+" - "+n+" of "+u)}function f(n,t){var i=n.TemplateName.toLowerCase(),r=t.TemplateName.toLowerCase();return i<r?-1:i>r?1:0}function e(n,t){var i=n.TemplateName.toLowerCase(),r=t.TemplateName.toLowerCase();return i<r?1:i>r?-1:0}function o(n,t){var i=Date.parse(n.ModifiedDate),r=Date.parse(t.ModifiedDate);return i<r?1:i>r?-1:0}function s(n,t){var i=Number(n.AddedCount),r=Number(t.AddedCount);return i<r?1:i>r?-1:0}var t=this,i=0,r=3;u();$(document).on("click","div.popup div.kpi-templates > a",function(i){var u=$s.labels.Are_you_sure_you_want_to_add_this_KPI_template,r=$("#template-confirmation"),f={id:$(this).data("item-id"),name:"X-Requested-With",value:"XMLHttpRequest"};return r.length||(r=$('<div id="template-confirmation" title="Please Confirm" style="display: none"><\/div>').appendTo($("body"))),r.html("<p>"+u+"<\/p>"),r.dialog({modal:!0,resizable:!1,position:{of:window,my:"center bottom",at:"center center"},buttons:[{text:$s.labels.Yes_add_it,click:function(){$.ajax({url:"/KPI/_AddTemplate",type:"POST",cache:!1,data:f,beforeSend:function(){Helper.setLoader()},complete:function(){Helper.clearLoader()},success:function(i){Helper.clearLoader();n.Helpers.Popups.closePopup("#dvTemplatesPopup");t.categories($.parseJSON(i));$s.toggleColLeftMenu(!0);t.formulaKpisList(null)}});$(this).dialog("close");r.remove()}},{text:$s.labels.No,click:function(){$(this).dialog("close");r.remove()}}]}),i.preventDefault(),!1});$("div.popup div.kpi-templates-footer > div > a").click(function(n){return i+=Number($(this).attr("data-page")),i<0&&(i=0),i>=Math.ceil(t.modelJson.Templates.length/r)&&(i=Math.ceil(t.modelJson.Templates.length/r)-1),u(),n.preventDefault(),!1});$("div.popup div.kpi-templates > div.sort > p > a").click(function(n){var r=$(this).attr("data-sortby");$("div.popup div.kpi-templates > div.sort > p > a").removeClass("selected");$(this).addClass("selected");switch(r){case"lt":t.modelJson.Templates=t.modelJson.Templates.sort(o);break;case"mp":t.modelJson.Templates=t.modelJson.Templates.sort(s);break;case"za":t.modelJson.Templates=t.modelJson.Templates.sort(e);break;default:t.modelJson.Templates=t.modelJson.Templates.sort(f)}return i=0,u(),n.preventDefault(),!1})},t.prototype.enableKpiSuccess=function(){var n=this;$("th.actions input, td.actions input:checked").prop("checked",!1);n.populateKpis(n.selectedCatId().toString());n.formulaKpisList(null)},t.prototype.checkedKpiIds=function(){var t="";return $("td.actions input:checked").each(function(n,i){t+=$(i).attr("id")+","}),t===""&&n.Helpers.Helper.dialog("No KPIs selected, please select one."),t},t.prototype.formInit=function(){window.scrollTo(0,0);$("#KPIName").focus()},t.prototype.populateKpis=function(n){var t=this;$.ajax({url:"/KPI/_KPIs/"+n,type:"GET",cache:!1,data:{name:"X-Requested-With",value:"XMLHttpRequest"},beforeSend:function(){Helper.setLoader()},success:function(n){Helper.clearLoader();t.kpis($.parseJSON(n))},complete:Helper.clearLoader})},t}();t.KpisModel=i})(t=n.Models||(n.Models={}))}(SimpleKPI||(SimpleKPI={}));Helper=SimpleKPI.Helpers.Helper,function(n){var t;(function(t){var i=function(){function t(){var t,i;this.wizardStep=null;this.animation=!0;t=this;this.financialMonth=1;this.startDayOfWeek=1;this.useIsoWeek=!0;i=function(t,i,r,u,f){var e=f,o;return f?Helper.sendCatchError(f):(arguments&&arguments.callee&&arguments.callee.caller&&(e=arguments.callee.caller()),o={message:t,line:r,file:i,column:u,error:e},n.Helpers.Helper.sendErrorDetail(-1,o,window.location.href,"")),!0};window.onerror=i;$(document).ajaxSend(function(n,t,i){ga!=null&&ga("send","pageview",i.url)});$(document).ajaxError(function(n,t,i,r){if(Helper.clearLoader(),t.status===401)Helper.dialog($s.labels.Your_session_has_expired,function(){location.reload()});else if(t.status===550){var u=t.responseText?t.responseText:r;Helper.dialog(u)}else Helper.sendError(t)});$(function(){if($(window).resize(function(){$("span.field-validation-error").each(function(){$(this).position({my:"left top",at:"left bottom",collision:"none",of:$("#"+$(this).attr("data-valmsg-for"))})});$("div.video-popup, div.popup, div.helper").length>0&&$("div.video-popup, div.popup, div.helper").position({my:"center center",at:"center center",of:window,collision:"fit"})}),$("div.tab-menu a").click(function(){ga!=null&&ga("send","event","Menu",$(this).attr("href"),null)}),n.Helpers.Helper.dropDownMenu("a.profile","#mnuProfile"),n.Helpers.Helper.dropDownMenu("a.help-support","#mnuHelp"),$("a[data-export=print]").click(function(n){return window.print(),n.preventDefault(),!1}),$("div.helper").position({my:"center",at:"center center-100px",of:window,collision:"fit"}),$("div.helper > a.close").click(function(n){var t=$(this).attr("href");return $.ajax({url:t,type:"POST",cache:!1,data:{name:"X-Requested-With",value:"XMLHttpRequest"}}),$(this).parent().fadeOut(),n.preventDefault(),!1}),n.Helpers.Helper.dropDownMenu("div.manage-my","ul.manage-my"),$("div.column-left a.menu-button, #aManageCategories").click(function(n){return t.toggleColLeftMenu(),n.preventDefault(),!1}),$(document).tooltip&&$(document).tooltip({show:{delay:800},position:{my:"center bottom-30",at:"top center",using:function(n,t){$(this).css(n);$("<div>").addClass("ui-tooltip-arrow").addClass(t.vertical).addClass(t.horizontal).appendTo(this)}}}),$("#dvCreateStart").length){n.Helpers.Popups.createPopup("#dvCreateStart");n.Helpers.Popups.repositionPopup("#dvCreateStart");$("#aSampleAccount, div.dash-create-message a.done").click(function(i){return t.setWizardStep(1),n.Helpers.Popups.closePopup("div.dash-create-message"),n.Helpers.Popups.closePopup("div.upload-file"),$("div.no-kpis").slideDown(),i.preventDefault(),!1});$("div.dash-create-message a.back").click(function(n){return $("#dvCreateLearn").hide(),$("#dvCreateHelp").hide(),$("#dvCreateStart").fadeIn(),n.preventDefault(),!1});$("#aUploadFileBack").click(function(n){return $("div.upload-file").hide(),$("#aUploadSpreadsheet").hide(),$("#dvCreateStart").fadeIn(),n.preventDefault(),!1});$("#aUploadSpreadsheet").click(function(t){return n.Helpers.Popups.createPopup("div.upload-file"),n.Helpers.Popups.repositionPopup("div.upload-file"),$("#dvCreateStart").hide(),$("div.upload-file a.cancel").click(function(n){return $("div.upload-file").hide(),$("#dvCreateStart").fadeIn(),n.preventDefault(),!1}),t.preventDefault(),!1});$("#dvCreateStart div.links > a").click(function(t){var i=$(this).data("popup").toString();return n.Helpers.Popups.createPopup(i),n.Helpers.Popups.repositionPopup(i),$("#dvCreateStart").hide(),t.preventDefault(),!1});$("#dvCreateHelp a.cancel").click(function(n){return $("#dvCreateHelp").hide(),$("#dvCreateStart").fadeIn(),n.preventDefault(),!1});$("#dvCreateHelp a.submit").click(function(n){return $("#dvCreateHelpForm").hide(),$("#dvCreateHelpDone").fadeIn(),$.ajax({url:"/Dashboards/_NeedHelp",type:"POST",cache:!1,data:[{name:"X-Requested-With",value:"XMLHttpRequest"},{name:"email",value:$("#chEmail").val()},{name:"skype",value:$("#chSkype").val()},{name:"phone",value:$("#chPhone").val()}],success:function(){}}),n.preventDefault(),!1});$("#frmUploadGSFile").ajaxForm({beforeSubmit:function(){return Helper.setLoader(),!0},error:function(n){var t=n.responseText?n.responseText:n.toString();Helper.clearLoader();Helper.dialog(t)},success:function(){Helper.clearLoader();setTimeout(function(){Helper.clearLoader();$("#dvUploadFile").hide();$("#dvUploadFileDone").fadeIn()},4e3)}});var i=n.Helpers.Helper.getIeVersion();if(i!==8&&i!==9)$("#dvUploadFile").on("click","#aGSSelectFile",function(n){return $("#uGSFile").show().focus().click().hide(),n.preventDefault(),!1});$(document).on("change","#uGSFile",function(n){var t=n.target.value.substring(n.target.value.lastIndexOf("\\")+1),i=new RegExp("^.*\\.(xls|XLS|xlsx|XLSX|csv|CSV)$");return t==null&&(t=""),t.match(i)||(t="",Helper.dialog($s.labels.Please_select_an_Excel_file_with_a_valid_extension)),t.length>0?($("#spnGSFileName").text(t),$("#frmUploadGSFile input[type=submit]").removeAttr("disabled").removeClass("button-disabled").addClass("button-green")):($("#spnGSFileName").text("No file selected"),$("#frmUploadGSFile input[type=submit]").attr("disabled","disabled").removeClass("button-green").addClass("button-disabled")),n.preventDefault(),!1})}t.dropdown()})}return t.prototype.toggleColLeftMenu=function(n){var t=$("div.column-left");t.width()<=50||n!=null&&n?t.animate({width:"250px"},500,function(){t.removeClass("column-left-closed").addClass("media-ignore")}):t.removeClass("media-ignore").addClass("column-left-closed").animate({width:"44px"});$("#aManageCategories").hide()},t.prototype.setWizardStep=function(n){var t=this;$.ajax({url:"/Shared/_SetWizardStep",type:"POST",cache:!1,data:[{name:"X-Requested-With",value:"XMLHttpRequest"},{name:"step",value:n}],success:function(){t.wizardStep=n}})},t.prototype.dropdown=function(){function i(n){$("dl.dropdown dt").not(n.find("dt")).removeClass("selected");$("dl.dropdown dd").not(n.children("dd")).hide();n.find("dt").toggleClass("selected")}var n=1e3,t=null;$(document).on("click","dl.dropdown dt",function(){var t=$(this).parent();i(t);t.children("dd").toggle().css("z-index",n);n++});$(document).on("keyup","dl.dropdown",function(r){r.keyCode===32&&(t=$(this),i(t),t.children("dd").toggle().css("z-index",n),n++)});$(document).click(function(n){var t=$(n.target);t.parents().hasClass("dropdown")||$(".dropdown dd").hide();t.parents("dl.dropdown").length===0&&$("dl.dropdown dd").hide()});$(document).on("click","dl.dropdown li",function(){var t=$(this),n=t.parent().parent().parent(),r=t.attr("data-id");if(n.children("dd").hide(),n.find("dt").removeClass("selected"),t.attr("data-link")!=null)window.location.replace(t.attr("data-link"));else if(n.attr("data-formula")!=null)$s.editor.setKpi(r,t.attr("data-name"));else if(n.find("dt > span").html(t.html()),$("#"+n.attr("data-input-id")).val(r).trigger("change"),n.attr("data-function")!=null){for(var f=n.attr("data-name"),u=(n.attr("data-function")||"").split("."),i=window[u.shift()];u.length>0;)i=i[u.shift()];typeof i=="function"&&i(r,t.html(),f)}})},t}();t.Shared=i})(t=n.Views||(n.Views={}))}(SimpleKPI||(SimpleKPI={}));$s=new SimpleKPI.Views.Shared